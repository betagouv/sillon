"use strict";(self.webpackChunksillon=self.webpackChunksillon||[]).push([[6436],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>v});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),d=r,v=p["".concat(l,".").concat(d)]||p[d]||m[d]||a;return n?i.createElement(v,o(o({ref:t},c),{},{components:n})):i.createElement(v,o({ref:t},c))}));function v(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8735:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var i=n(7462),r=(n(7294),n(3905));const a={hide_table_of_contents:!0},o="Avoir de la r\xe9activit\xe9 avec une API traditionnelle",s={unversionedId:"client-server-communication/reactivity-with-traditional-api",id:"client-server-communication/reactivity-with-traditional-api",title:"Avoir de la r\xe9activit\xe9 avec une API traditionnelle",description:"Lorsque votre application autorise des interactions entre plusieurs utilisateurs (directement ou indirectement), il peut \xeatre envisag\xe9 d'avoir des mises \xe0 jour de la donn\xe9e en temps r\xe9el.",source:"@site/docs/client-server-communication/reactivity-with-traditional-api.mdx",sourceDirName:"client-server-communication",slug:"/client-server-communication/reactivity-with-traditional-api",permalink:"/docs/client-server-communication/reactivity-with-traditional-api",draft:!1,editUrl:"https://github.com/betagouv/sillon/tree/main/docs/client-server-communication/reactivity-with-traditional-api.mdx",tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"docs",previous:{title:"Pr\xe9f\xe9rez l'API \xe0 la mise en cache frontend",permalink:"/docs/client-server-communication/prefer-api-to-frontend-caching"},next:{title:"Une base de donn\xe9es qui fait tout (vraiment)",permalink:"/docs/database-for-everything"}},l={},u=[{value:"Cas avanc\xe9 et plus complexe",id:"cas-avanc\xe9-et-plus-complexe",level:2},{value:"Cas standard et simple",id:"cas-standard-et-simple",level:2}],c={toc:u},p="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"avoir-de-la-r\xe9activit\xe9-avec-une-api-traditionnelle"},"Avoir de la r\xe9activit\xe9 avec une API traditionnelle"),(0,r.kt)("p",null,"Lorsque votre application autorise des interactions entre plusieurs utilisateurs (directement ou indirectement), il peut \xeatre envisag\xe9 d'avoir des mises \xe0 jour de la donn\xe9e en temps r\xe9el."),(0,r.kt)("h2",{id:"cas-avanc\xe9-et-plus-complexe"},"Cas avanc\xe9 et plus complexe"),(0,r.kt)("p",null,"J'ai une application bancaire et j'aimerais voir en temps r\xe9el dans mon application mon solde se mettre \xe0 jour si une transaction se produit. Il faut pour cela que votre backend notifie votre frontend des donn\xe9es \xe0 mettre \xe0 jour, ou tout simplement en envoyant un ordre similaire \xe0 \"rejoue tes requ\xeates\"."),(0,r.kt)("p",null,"2 solutions s'offrent \xe0 vous :"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'Qu\'\xe0 son lancement le frontend se manifeste aupr\xe8s du serveur pour maintenir un canal "de souscriptions en temps r\xe9el" (que ce soit une ',(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/WebSocket"},"WebSocket")," ou du ",(0,r.kt)("a",{parentName:"li",href:"https://en.wiktionary.org/wiki/long_polling"},"long-polling"),"). Cela peut se faire ",(0,r.kt)("a",{parentName:"li",href:"https://trpc.io/docs/subscriptions"},"directement avec la librairie tRPC")," que nous conseillons ;"),(0,r.kt)("li",{parentName:"ol"},"Il est aussi envisageable d'utiliser les ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Push_technology"},"Push notifications")," qui sont maintenant un standard mobile et web. \xc0 noter qu'elles font surtout sens pour permettre de notifier un utilisateur m\xeame lorsque l'application num\xe9rique n'est pas ouverte. Par exemple, si vous recevez un message dans votre applicatif, vous aurez une notification de votre navigateur web m\xeame si vous n'avez pas l'application ouverte. ",(0,r.kt)("em",{parentName:"li"},"Pour cette solution pr\xe9cis\xe9ment, il est recommand\xe9 d'utiliser un service connu pour la distribution des Push notifications afin de vous simplifier la gestion des envois (bien que cela rajoute un acteur tiers)."))),(0,r.kt)("h2",{id:"cas-standard-et-simple"},"Cas standard et simple"),(0,r.kt)("p",null,'Vous pouvez aussi apporter de la r\xe9activit\xe9 frontend sans avoir de notification de la part du backend. Techniquement cela para\xeet tr\xe8s "sommaire" mais c\'est terriblement ing\xe9nieux. Quelques exemples :'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Je soumets un formulaire, les requ\xeates ",(0,r.kt)("em",{parentName:"li"},"(queries)")," sont automatiquement rejou\xe9es et la page met \xe0 jour ses donn\xe9es sans rechargement visible. Si vous utilisez une ",(0,r.kt)("a",{parentName:"li",href:"/docs/database-for-everything/"},"base de donn\xe9es atomique"),", les donn\xe9es soumises apparaissent directement sans devoir mettre en place des ",(0,r.kt)("em",{parentName:"li"},"patchs")," manuels de l'interface. Cela est possible car c'est le m\xeame client qui g\xe8re les ",(0,r.kt)("em",{parentName:"li"},"queries")," et les ",(0,r.kt)("em",{parentName:"li"},"mutations")," ;"),(0,r.kt)("li",{parentName:"ul"},"Je vais sur un autre onglet pendant X minutes, je reviens, et tous les ",(0,r.kt)("em",{parentName:"li"},"getters")," sont rejou\xe9s ;"),(0,r.kt)("li",{parentName:"ul"},"L'application peut aussi explicitement forcer le rafra\xeechissement des donn\xe9es sans rechargement.")),(0,r.kt)("p",null,"Cela est possible suivant le client HTTP que vous utilisez. Nous avons fait le choix de ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/TanStack/query"},(0,r.kt)("inlineCode",{parentName:"a"},"react-query"))," qui est directement compatible avec ",(0,r.kt)("a",{parentName:"p",href:"https://trpc.io/"},"tRPC"),". Sans configuration explicite on b\xe9n\xe9ficie des exemples cit\xe9s."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Si vous n'avez pas d'API tRPC mais un format standard type OpenAPI, vous pouvez g\xe9n\xe9rer un client ",(0,r.kt)("inlineCode",{parentName:"p"},"react-query")," gr\xe2ce \xe0 des librairies comme ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fabien0102/openapi-codegen"},(0,r.kt)("inlineCode",{parentName:"a"},"openapi-codegen"))," ou encore ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/anymaniax/orval"},(0,r.kt)("inlineCode",{parentName:"a"},"orval")),".")))}m.isMDXComponent=!0}}]);