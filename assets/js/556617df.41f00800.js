"use strict";(self.webpackChunksillon=self.webpackChunksillon||[]).push([[1673],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(r),m=a,f=p["".concat(u,".").concat(m)]||p[m]||d[m]||o;return r?n.createElement(f,i(i({ref:t},c),{},{components:r})):n.createElement(f,i({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6032:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=r(7462),a=(r(7294),r(3905));const o={hide_table_of_contents:!0},i="3-2-1 : stateful !",s={unversionedId:"backups/3-2-1-strategy",id:"backups/3-2-1-strategy",title:"3-2-1 : stateful !",description:"La mise en place de backups est primordiale pour assurer la continuit\xe9 d'un service en cas de d\xe9g\xe2t technique, inattention ou piratage.",source:"@site/docs/backups/3-2-1-strategy.mdx",sourceDirName:"backups",slug:"/backups/3-2-1-strategy",permalink:"/docs/backups/3-2-1-strategy",draft:!1,editUrl:"https://github.com/betagouv/sillon/tree/main/docs/backups/3-2-1-strategy.mdx",tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"docs",previous:{title:"Le code source",permalink:"/docs/backups/source-code"},next:{title:"Plan \xe0 suivre en cas d'incident",permalink:"/docs/backups/incident-plan"}},u={},l=[],c={toc:l},p="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(p,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"3-2-1--stateful-"},"3-2-1 : stateful !"),(0,a.kt)("p",null,"La mise en place de backups est primordiale pour assurer la continuit\xe9 d'un service en cas de d\xe9g\xe2t technique, inattention ou piratage."),(0,a.kt)("p",null,"Nous pr\xe9conisons le pattern ",(0,a.kt)("a",{parentName:"p",href:"https://fr.wikipedia.org/wiki/Sauvegarde_(informatique)"},"3-2-1")," :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"3 copies de la m\xeame donn\xe9e (l'original et 2 copies) ;"),(0,a.kt)("li",{parentName:"ul"},"2 types de stockage diff\xe9rents ;"),(0,a.kt)("li",{parentName:"ul"},'1 copie "hors site" ;')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},'Dans le cas o\xf9 votre "stateful" est seulement dans PostgreSQL cela va vous simplifier la vie car vous n\'aurez besoin que de faire un dump de la base de donn\xe9es. Si par contre vous avez un outil comme S3, vous pouvez utiliser des outils comme ',(0,a.kt)("a",{parentName:"p",href:"https://rclone.org/"},"rclone")," pour synchroniser votre S3 original avec un S3 de backup (en d\xe9sactivant les synchronisations imm\xe9diates de suppression).")),(0,a.kt)("p",null,"Si l'on transpose ce pattern \xe0 notre cas :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"La donn\xe9e originale est dans PostgreSQL ;"),(0,a.kt)("li",{parentName:"ul"},"L'h\xe9bergeur fait automatiquement des backups de la base PostgreSQL et les garde quelques jours ou quelques semaines (\u2705 pour les 2 types de stockage) ;"),(0,a.kt)("li",{parentName:"ul"},'On fait r\xe9guli\xe8rement tourner un dump via un "cron job" pour faire un backup de la donn\xe9e originale et la mettre en s\xfbret\xe9 dans un S3 chez un autre h\xe9bergeur sur une r\xe9gion diff\xe9rente (\u2705 pour les 3 copies distinctes et \u2705 pour avoir 1 copie sur une localisation diff\xe9rente).')),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},'Id\xe9alement pour la copie n\xb03 on fait une copie du backup de l\'h\xe9bergeur afin de ne pas surcharger la production, mais certains h\xe9bergeurs font des backups "point-in-time recovery" qui ne sont pas r\xe9cup\xe9rables.')),(0,a.kt)("admonition",{title:"S\xe9curit\xe9",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Pour la copie hors site il est pr\xe9f\xe9rable que le \"job\" tourne \xe0 l'ext\xe9rieur de l'h\xe9bergeur de la production. Pour illustrer :"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Le job a acc\xe8s en lecture sur la production ;"),(0,a.kt)("li",{parentName:"ul"},'Le job a acc\xe8s en lecture et \xe9criture sur le S3 "hors site" ;'),(0,a.kt)("li",{parentName:"ul"},"Si l'environnement de production est compromis par un piratage, on est s\xfbrs qu'ils n'ont pas acc\xe8s \xe0 l'environnement \"hors site\". Et s'ils ont acc\xe8s au job, ils n'ont pas les droits pour d\xe9truire la production."))))}d.isMDXComponent=!0}}]);