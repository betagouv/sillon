"use strict";(self.webpackChunksillon=self.webpackChunksillon||[]).push([[9477],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,u=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=l(n),m=i,f=c["".concat(u,".").concat(m)]||c[m]||d[m]||s;return n?r.createElement(f,a(a({ref:t},p),{},{components:n})):r.createElement(f,a({ref:t},p))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,a=new Array(s);a[0]=m;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o[c]="string"==typeof e?e:i,a[1]=o;for(var l=2;l<s;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8473:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var r=n(7462),i=(n(7294),n(3905));const s={hide_table_of_contents:!0},a="Les tests et la limite du mock",o={unversionedId:"tests-and-the-mock-limit/index",id:"tests-and-the-mock-limit/index",title:"Les tests et la limite du mock",description:"Nous ne sommes pas pour imposer des tests \xe0 tous les niveaux et sur tout votre code applicatif. Il est beaucoup plus important selon nous de :",source:"@site/docs/tests-and-the-mock-limit/index.mdx",sourceDirName:"tests-and-the-mock-limit",slug:"/tests-and-the-mock-limit/",permalink:"/docs/tests-and-the-mock-limit/",draft:!1,editUrl:"https://github.com/betagouv/sillon/tree/main/docs/tests-and-the-mock-limit/index.mdx",tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"docs",previous:{title:"Avoir diff\xe9rents environnements",permalink:"/docs/environments/"},next:{title:"La gestion d'erreurs",permalink:"/docs/error-handling/"}},u={},l=[],p={toc:l},c="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(c,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"les-tests-et-la-limite-du-mock"},"Les tests et la limite du mock"),(0,i.kt)("p",null,"Nous ne sommes pas pour imposer des tests \xe0 tous les niveaux et sur tout votre code applicatif. Il est beaucoup plus important selon nous de :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"D\xe9montrer que votre produit sert r\xe9ellement en r\xe9pondant aux besoins utilisateurs (et donc en d\xe9veloppant des fonctionnalit\xe9s) ;"),(0,i.kt)("li",{parentName:"ul"},"D'avoir un maximum de flexibilit\xe9 dans la maintenance de votre outil, car m\xeame en testant, il vous arrivera des p\xe9pins auxquels vous n'auriez jamais pens\xe9s.")),(0,i.kt)("p",null,"Essayez de focaliser vos tests unitaires sur des briques critiques qui g\xe8rent de la donn\xe9e m\xe9tier (validation d'un num\xe9ro de t\xe9l\xe9phone, g\xe9n\xe9ration d'une URL sign\xe9e pour un fichier\u2026). Apr\xe8s si vous \xeates \xe0 l'aise et efficace avec le ",(0,i.kt)("a",{parentName:"p",href:"https://fr.wikipedia.org/wiki/Test_driven_development"},"TDD")," ou le ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Behavior-driven_development"},"BDD"),", bien entendu il faut continuer les pratiques qui marchent \ud83d\ude09."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"De toute fa\xe7on avec le temps votre pourcentage de couverture en tests va progresser, il est probable qu'\xe0 chaque bug remont\xe9 il soit plus facile de le tester de mani\xe8re isol\xe9e de l'applicatif (impliquant de faire des tests unitaires pour facilement d\xe9bugger).")),(0,i.kt)("p",null,"Par contre, quand on veut tester \xe0 un niveau plus abstrait on se retrouve souvent \xe0 faire des mocks qui ne veulent plus rien dire puisqu'on les a fait sp\xe9cifiquement pour que le test concern\xe9 passe. Par exemple, si l'on veut tester un code qui a des interactions avec la base de donn\xe9es, on peut essayer de mocker la base, mais \xe7a ne nous dira jamais si finalement la requ\xeate de jointure ou les ",(0,i.kt)("inlineCode",{parentName:"p"},"SELECT")," imbriqu\xe9s auraient march\xe9 dans une vraie situation. Il existe pourtant bien quelques librairies qui essaient de faire \"database in memory\" mais \xe7a ne reste qu'une pseudo-copie o\xf9 vous n'aurez pas les vraies probl\xe9matiques de l'outil."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Si vous souhaitez faire des tests d'int\xe9gration, nous pr\xe9conisons de faire des tests en restant local \xe0 votre code, avec toute la logique dans votre test (comme pour des tests unitaires). Pour cela nous utilisons ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/testcontainers/testcontainers-node"},(0,i.kt)("inlineCode",{parentName:"a"},"test-containers"))," qui va communiquer avec votre Docker local pour peupler de fa\xe7on \xe9ph\xe9m\xe8re par exemple une PostgreSQL, un ",(0,i.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/aerzas/mailcatcher"},(0,i.kt)("inlineCode",{parentName:"a"},"mailcatcher")),"\u2026 afin de faire des tests qui reproduisent un minimum l'environnement de production. Comme l'image d'un container est en cache apr\xe8s le premier test, peupler un container prend \xe0 peine quelques secondes et cela devient totalement transparent."),(0,i.kt)("p",{parentName:"admonition"},'Le processus marche aussi dans les CI/CD (en tout cas sur GitHub Actions) puisque le runner Docker est disponible via son API HTTP, donc vos tests sont en mesure de dire \xe0 la pipeline "peuple un container, puis \xe9teins-le". Plus besoin de sp\xe9cifier en dur dans la pipeline les potentielles d\xe9pendances de services \ud83d\ude4c.')))}d.isMDXComponent=!0}}]);