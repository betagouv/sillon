"use strict";(self.webpackChunksillon=self.webpackChunksillon||[]).push([[1931],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var i=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,i,a=function(e,t){if(null==e)return{};var r,i,a={},n=Object.keys(e);for(i=0;i<n.length;i++)r=n[i],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)r=n[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=i.createContext({}),u=function(e){var t=i.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return i.createElement(o.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var r=e.components,a=e.mdxType,n=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(r),d=a,f=p["".concat(o,".").concat(d)]||p[d]||m[d]||n;return r?i.createElement(f,s(s({ref:t},c),{},{components:r})):i.createElement(f,s({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=r.length,s=new Array(n);s[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:a,s[1]=l;for(var u=2;u<n;u++)s[u]=r[u];return i.createElement.apply(null,s)}return i.createElement.apply(null,r)}d.displayName="MDXCreateElement"},9398:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>m,frontMatter:()=>n,metadata:()=>l,toc:()=>u});var i=r(7462),a=(r(7294),r(3905));const n={hide_table_of_contents:!0},s="Se pr\xe9munir des fichiers infect\xe9s",l={unversionedId:"security/avoid-infected-files",id:"security/avoid-infected-files",title:"Se pr\xe9munir des fichiers infect\xe9s",description:"C'est malheureux mais il faut toujours se m\xe9fier des donn\xe9es qui entrent dans votre applicatif, encore plus quand il s'agit de fichiers. Quelques exemples :",source:"@site/docs/security/avoid-infected-files.mdx",sourceDirName:"security",slug:"/security/avoid-infected-files",permalink:"/docs/security/avoid-infected-files",draft:!1,editUrl:"https://github.com/betagouv/sillon/tree/main/docs/security/avoid-infected-files.mdx",tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"docs",previous:{title:"S\xe9curiser les URLs des fichiers h\xe9berg\xe9s",permalink:"/docs/security/secure-hosted-files-urls"},next:{title:"Faire conna\xeetre son produit",permalink:"/docs/growth"}},o={},u=[],c={toc:u},p="wrapper";function m(e){let{components:t,...r}=e;return(0,a.kt)(p,(0,i.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"se-pr\xe9munir-des-fichiers-infect\xe9s"},"Se pr\xe9munir des fichiers infect\xe9s"),(0,a.kt)("p",null,"C'est malheureux mais il faut toujours se m\xe9fier des donn\xe9es qui entrent dans votre applicatif, encore plus quand il s'agit de fichiers. Quelques exemples :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"On peut utiliser une extension d'image sur un fichier ex\xe9cutable pour qu'il passe des v\xe9rifications trop sommaires ;"),(0,a.kt)("li",{parentName:"ul"},"M\xeame si vous utilisez un h\xe9bergeur de fichiers S3, celui-ci ne s'occupe en g\xe9n\xe9ral pas de vous pr\xe9munir des virus ;"),(0,a.kt)("li",{parentName:"ul"},"On peut injecter du code malicieux au sein de fichiers comme des PDF, alors qu'\xe0 premi\xe8re vue un fichier PDF semble inoffensif. Cela va d\xe9pendre du logiciel qui ouvre ce fichier ;"),(0,a.kt)("li",{parentName:"ul"},"Un fichier infect\xe9 qui se retrouve dans votre applicatif sera peut-\xeatre r\xe9cup\xe9r\xe9 par un agent public, et peut contaminer son ordinateur voire tout le r\xe9seau de son travail. Et dans ce cas\u2026 on ne peut pas le bl\xe2mer, ",(0,a.kt)("strong",{parentName:"li"},"c'est l'applicatif qui est cens\xe9 apporter de la s\xe9curit\xe9 \xe0 ses utilisateurs")," !")),(0,a.kt)("p",null,"Voici quelques pistes pour essayer de contrer ce type d'attaque :"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Comme mentionn\xe9 dans le chapitre ",(0,a.kt)("a",{parentName:"li",href:"/docs/database-for-everything/file-storage"},"sur le stockage de fichiers"),", l'upload de fichiers ne se fait pas en 1 temps. Il vaut mieux faire d'abord l'upload sur un endpoint d\xe9di\xe9 pour r\xe9cup\xe9rer l'identifiant du fichier, et dans un second temps transmettre cet identifiant dans le formulaire m\xe9tier. Le \"temps 1\" est une bonne occasion pour effectuer les v\xe9rifications list\xe9es plus bas. Si jamais vos fichiers sont trop gros et que vous ne voulez pas bloquer de mani\xe8re synchrone l'utilisateur le temps de l'analyse, vous pouvez les effectuer en asynchrone, en choisissant que tant qu'elles ne sont pas termin\xe9es l'API refusera de servir l'URL du fichier. \xc0 vous de d\xe9terminer ce qui est le plus appropri\xe9 ;"),(0,a.kt)("li",{parentName:"ol"},"Ne pas faire confiance aux ",(0,a.kt)("a",{parentName:"li",href:"https://fr.wikipedia.org/wiki/M%C3%A9tadonn%C3%A9e"},"metadatas")," que le frontend vous joint en m\xeame temps que le fichier. Une fois le fichier dans votre zone tampon vous pouvez v\xe9rifier son vrai type en analysant le marqueur au sein du fichier (cela peut se faire avec ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/LarsKoelpin/magic-bytes"},(0,a.kt)("inlineCode",{parentName:"a"},"magic-bytes")),"). L'id\xe9e est que certains types de fichier (hors simple fichier texte par exemple) ont une suite de premiers ",(0,a.kt)("a",{parentName:"li",href:"https://fr.wikipedia.org/wiki/Byte"},"bytes")," connue, donc sans analyser la totalit\xe9 du fichier on peut savoir d\xe9j\xe0 s'il correspond au type que l'on attendait. ",(0,a.kt)("strong",{parentName:"li"},'C\'est une premi\xe8re v\xe9rification "rapide"')," ;"),(0,a.kt)("li",{parentName:"ol"},"Et comme n'importe quel fichier peut potentiellement contenir du code malicieux, il est utile d'utiliser un antivirus pour scanner l'int\xe9gralit\xe9 du fichier. ",(0,a.kt)("strong",{parentName:"li"},'C\'est une v\xe9rification "lente" mais compl\xe8te'),". Nous pr\xe9conisons d'utiliser l'outil ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/Cisco-Talos/clamav"},"ClamAV")," via la librairie JavaScript ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/kylefarris/clamscan"},"clamscan"),". Comme c'est un ex\xe9cutable, il faut soit :",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"L'avoir en local dans le m\xeame container que votre applicatif :",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Pour des buildpacks : ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/Scalingo/clamav-buildpack"},"https://github.com/Scalingo/clamav-buildpack")," ;"),(0,a.kt)("li",{parentName:"ol"},"Pour des environnements o\xf9 vous avez la main (via Dockerfile par exemple), l'installer avec un gestionnaire de packages ;"))),(0,a.kt)("li",{parentName:"ol"},"L'avoir accessible sur le r\xe9seau et interagir avec par TCP (par exemple en d\xe9ployant ",(0,a.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/clamav/clamav/"},"l'image Docker officielle"),"). Ce cas est \xe0 privil\xe9gier si :",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Vous n'avez pas la possibilit\xe9 de l'embarquer avec votre applicatif ;"),(0,a.kt)("li",{parentName:"ol"},"Vous \xeates limit\xe9s en ressources pour votre applicatif, et ne voulez pas le p\xe9naliser ;"),(0,a.kt)("li",{parentName:"ol"},"Vous voulez mutualiser l'instance pour plusieurs applicatifs.")))))),(0,a.kt)("p",null,"Il est important de garder en t\xeate qu'",(0,a.kt)("strong",{parentName:"p"},"un antivirus aura toujours un temps de retard sur les failles"),'. Vos fichiers h\xe9berg\xe9s peuvent \xeatre d\xe9tect\xe9s "inoffensifs" \xe0 l\'instant T, mais corrompus en les scannant de nouveau 3 semaines plus tard (car vous aurez mis \xe0 jour la base de connaissance de votre antivirus). La r\xe9currence des scans d\xe9pend de votre contexte :'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Si vous n'h\xe9bergez que des images (type ",(0,a.kt)("inlineCode",{parentName:"li"},".jpg"),", ",(0,a.kt)("inlineCode",{parentName:"li"},".png"),"\u2026), il est probable que seul le scan initial soit suffisant puisque les utilisateurs sont cens\xe9s ouvrir ce fichier dans un logiciel appropri\xe9 (qui ne va pas ex\xe9cuter le fichier). Vous pourriez vous passer de la complexit\xe9 et du co\xfbt de tout rescanner ;"),(0,a.kt)("li",{parentName:"ul"},"Si vous h\xe9bergez des documents plus complexes (tableurs, fichiers ex\xe9cutables\u2026), il faut malheureusement \xeatre tr\xe8s vigilant, et scanner p\xe9riodiquement fait sens (avec le pr\xe9requis d'avoir mis \xe0 jour votre antivirus entre chaque occurrence).")))}m.isMDXComponent=!0}}]);