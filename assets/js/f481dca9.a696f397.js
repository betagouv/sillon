"use strict";(self.webpackChunksillon=self.webpackChunksillon||[]).push([[5387],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=l(r),d=a,h=u["".concat(c,".").concat(d)]||u[d]||m[d]||o;return r?n.createElement(h,s(s({ref:t},p),{},{components:r})):n.createElement(h,s({ref:t},p))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[u]="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3854:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=r(7462),a=(r(7294),r(3905));const o={hide_table_of_contents:!0},s="Moteur de recherche",i={unversionedId:"database-for-everything/search-engine",id:"database-for-everything/search-engine",title:"Moteur de recherche",description:"Certains produits auront peut-\xeatre besoin d'un outil lourd comme ElasticSearch pour stocker et optimiser les recherches \xe0 effectuer, mais encore une fois, dans la grande majorit\xe9 des cas votre PostgreSQL suffira.",source:"@site/docs/database-for-everything/search-engine.mdx",sourceDirName:"database-for-everything",slug:"/database-for-everything/search-engine",permalink:"/docs/database-for-everything/search-engine",draft:!1,editUrl:"https://github.com/betagouv/sillon/tree/main/docs/database-for-everything/search-engine.mdx",tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"docs",previous:{title:"Cache",permalink:"/docs/database-for-everything/cache"},next:{title:"Faire la maintenance",permalink:"/docs/database-for-everything/maintenance"}},c={},l=[],p={toc:l},u="wrapper";function m(e){let{components:t,...r}=e;return(0,a.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"moteur-de-recherche"},"Moteur de recherche"),(0,a.kt)("p",null,"Certains produits auront peut-\xeatre besoin d'un outil lourd comme ",(0,a.kt)("a",{parentName:"p",href:"https://www.elastic.co/"},"ElasticSearch")," pour stocker et optimiser les recherches \xe0 effectuer, mais encore une fois, dans la grande majorit\xe9 des cas ",(0,a.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/textsearch.html"},"votre PostgreSQL suffira"),"."),(0,a.kt)("p",null,"Nous ne vous proposons quand m\xeame pas de retourner \xe0 l'op\xe9rateur SQL ",(0,a.kt)("inlineCode",{parentName:"p"},"LIKE %ma recherche%")," \ud83d\udc75, mais plut\xf4t d'utiliser ",(0,a.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/datatype-textsearch.html"},"les types de donn\xe9es ",(0,a.kt)("inlineCode",{parentName:"a"},"tsquery")," et ",(0,a.kt)("inlineCode",{parentName:"a"},"tsvector")),". Si comme conseill\xe9 vous utilisez l'ORM Prisma, l'utilisation est ",(0,a.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/concepts/components/prisma-client/full-text-search"},"assez facile et quasi transparente sur des colonnes distinctes"),'. Par contre cela ne marchera pas si vous cherchez "John Doe" et que "John" est dans la colonne ',(0,a.kt)("inlineCode",{parentName:"p"},"firstname"),' et "Doe" dans la colonne ',(0,a.kt)("inlineCode",{parentName:"p"},"lastname"),"."),(0,a.kt)("p",null,"Pour faire ce type de recherche sur plusieurs colonnes (exemple : le pr\xe9nom, le nom, l'adresse, la biographie), la strat\xe9gie est de ",(0,a.kt)("a",{parentName:"p",href:"https://fr.wiktionary.org/wiki/concat%C3%A9ner"},"concat\xe9ner")," chaque colonne voulue ",(0,a.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/ddl-generated-columns.html"},"dans une colonne g\xe9n\xe9r\xe9e")," et index\xe9e, repr\xe9sentant un ",(0,a.kt)("inlineCode",{parentName:"p"},"tsvector"),". Cette colonne est donc optimis\xe9e pour de la recherche."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/prisma/prisma/issues/6336"},"Prisma ne g\xe8re pas encore nativement les colonnes g\xe9n\xe9r\xe9es"),", mais rien ne vous emp\xeache de la cr\xe9er \xe0 la main. Diff\xe9rents articles existent sur internet mais pour vous donner une id\xe9e cela donnerait quelque chose comme :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:"showLineNumbers",showLineNumbers:!0},"ALTER TABLE MyTable\nADD search TSVECTOR\nGENERATED ALWAYS AS (\n  to_tsvector('english',\n    firstname || ' ' || lastname || ' ' || biography || ' ' || full_address\n  )\n) STORED;\n")),(0,a.kt)("p",null,"Plut\xf4t que de juste concat\xe9ner b\xeatement les colonnes, on transforme le tout en ",(0,a.kt)("inlineCode",{parentName:"p"},"tsvector")," afin qu'il soit d\xe9j\xe0 optimis\xe9 pour la recherche."),(0,a.kt)("admonition",{title:"\xc0 savoir",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Un ",(0,a.kt)("inlineCode",{parentName:"p"},"tsvector")," est optimis\xe9 pour une langue en particulier afin de trier les mots. Par d\xe9faut, c'est la configuration ",(0,a.kt)("inlineCode",{parentName:"p"},"default_text_search_config")," qui est utilis\xe9e. Sachez que m\xeame si votre contenu est en fran\xe7ais, faites des tests avec ",(0,a.kt)("inlineCode",{parentName:"p"},"english")," avant d'utiliser la valeur ",(0,a.kt)("inlineCode",{parentName:"p"},"french"),". Cette derni\xe8re diff\xe9rencie les mots avec ou sans accent, ce qui peut \xeatre probl\xe9matique\u2026 N'h\xe9sitez pas \xe0 jeter un \u0153il \xe0 ",(0,a.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/textsearch-psql.html"},"toutes les options de langues possibles"),".")))}m.isMDXComponent=!0}}]);