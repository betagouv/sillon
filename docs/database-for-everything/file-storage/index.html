<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-database-for-everything/file-storage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Stockage de fichiers (au revoir buckets S3) | Sillon</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://sillon.incubateur.net/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://sillon.incubateur.net/img/social-card.png"><meta data-rh="true" property="og:url" content="https://sillon.incubateur.net/docs/database-for-everything/file-storage/"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Stockage de fichiers (au revoir buckets S3) | Sillon"><meta data-rh="true" name="description" content="Bien que le bucket S3 soit devenu une référence voire même le choix par défaut quand on commence un projet, on aimerait vous mettre en garde en redétaillant l&#x27;intégration d&#x27;un bucket S3 au sein d&#x27;un applicatif."><meta data-rh="true" property="og:description" content="Bien que le bucket S3 soit devenu une référence voire même le choix par défaut quand on commence un projet, on aimerait vous mettre en garde en redétaillant l&#x27;intégration d&#x27;un bucket S3 au sein d&#x27;un applicatif."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://sillon.incubateur.net/docs/database-for-everything/file-storage/"><link data-rh="true" rel="alternate" href="https://sillon.incubateur.net/docs/database-for-everything/file-storage/" hreflang="fr"><link data-rh="true" rel="alternate" href="https://sillon.incubateur.net/docs/database-for-everything/file-storage/" hreflang="x-default"><link rel="preconnect" href="https://stats.beta.gouv.fr/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://stats.beta.gouv.fr/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","52"]);var t=document,a=t.createElement("script"),p=t.getElementsByTagName("script")[0];a.type="text/javascript",a.async=!0,a.src=e+"matomo.js",p.parentNode.insertBefore(a,p)}()</script><link rel="stylesheet" href="/assets/css/styles.c035a662.css">
<link rel="preload" href="/assets/js/runtime~main.27e77d59.js" as="script">
<link rel="preload" href="/assets/js/main.133bd396.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/assets/logo/betagouv.png" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/assets/logo/betagouv.png" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Sillon</b></a></div><div class="navbar__items navbar__items--right"><a href="/assets/sillon.pdf" class="button button--secondary margin-horiz--sm hide-on-small"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="file-lines" class="svg-inline--fa fa-file-lines margin-right--sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M64 464c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16H224v80c0 17.7 14.3 32 32 32h80V448c0 8.8-7.2 16-16 16H64zM64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V154.5c0-17-6.7-33.3-18.7-45.3L274.7 18.7C262.7 6.7 246.5 0 229.5 0H64zm56 256c-13.3 0-24 10.7-24 24s10.7 24 24 24H264c13.3 0 24-10.7 24-24s-10.7-24-24-24H120zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24H264c13.3 0 24-10.7 24-24s-10.7-24-24-24H120z"></path></svg>PDF</a><button class="button button--secondary margin-horiz--sm hide-on-small"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="comment" class="svg-inline--fa fa-comment margin-right--sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M123.6 391.3c12.9-9.4 29.6-11.8 44.6-6.4c26.5 9.6 56.2 15.1 87.8 15.1c124.7 0 208-80.5 208-160s-83.3-160-208-160S48 160.5 48 240c0 32 12.4 62.8 35.7 89.2c8.6 9.7 12.8 22.5 11.8 35.5c-1.4 18.1-5.7 34.7-11.3 49.4c17-7.9 31.1-16.7 39.4-22.7zM21.2 431.9c1.8-2.7 3.5-5.4 5.1-8.1c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208s-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6c-15.1 6.6-32.3 12.6-50.1 16.1c-.8 .2-1.6 .3-2.4 .5c-4.4 .8-8.7 1.5-13.2 1.9c-.2 0-.5 .1-.7 .1c-5.1 .5-10.2 .8-15.3 .8c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c4.1-4.2 7.8-8.7 11.3-13.5c1.7-2.3 3.3-4.6 4.8-6.9c.1-.2 .2-.3 .3-.5z"></path></svg>Support</button><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Recherche" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Présentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/preamble/">Préambule</a><button aria-label="Plier/Déplier la catégorie &#x27;Préambule&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/project-start/">Amorce du projet</a><button aria-label="Plier/Déplier la catégorie &#x27;Amorce du projet&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/prototyping/">Prototypage</a><button aria-label="Plier/Déplier la catégorie &#x27;Prototypage&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/development/">Développement du produit</a><button aria-label="Plier/Déplier la catégorie &#x27;Développement du produit&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/document/">Documenter votre projet</a><button aria-label="Plier/Déplier la catégorie &#x27;Documenter votre projet&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/community-and-open-source/">Communauté &amp; open source</a><button aria-label="Plier/Déplier la catégorie &#x27;Communauté &amp; open source&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/sovereignty/">Souveraineté du projet</a><button aria-label="Plier/Déplier la catégorie &#x27;Souveraineté du projet&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/state-identity/">Utiliser la charte graphique de l&#x27;État</a><button aria-label="Plier/Déplier la catégorie &#x27;Utiliser la charte graphique de l&#x27;État&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/technical-recommandations/">Recommandations techniques argumentées</a><button aria-label="Plier/Déplier la catégorie &#x27;Recommandations techniques argumentées&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/frontend-backend-close/">Rapprocher le frontend du backend</a><button aria-label="Plier/Déplier la catégorie &#x27;Rapprocher le frontend du backend&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/typed-language/">Un langage typé</a><button aria-label="Plier/Déplier la catégorie &#x27;Un langage typé&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/web-framework-strategy/">Une même stratégie : un framework web</a><button aria-label="Plier/Déplier la catégorie &#x27;Une même stratégie : un framework web&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/i18n-recommended/">Toujours utiliser un module i18n</a><button aria-label="Plier/Déplier la catégorie &#x27;Toujours utiliser un module i18n&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backend-framework/">… Et le framework backend ?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/client-server-communication/">Communications client-serveur</a><button aria-label="Plier/Déplier la catégorie &#x27;Communications client-serveur&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/database-for-everything/">Une base de données qui fait tout (vraiment)</a><button aria-label="Plier/Déplier la catégorie &#x27;Une base de données qui fait tout (vraiment)&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/relational-databases/">RDBMS… simplement du relationnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/orm/">ORM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/postgresql-rather-than-mysql/">PostgreSQL plutôt que MySQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/dream-of-unique-storage/">Un seul espace de stockage, ça serait le rêve ?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/database-for-everything/file-storage/">Stockage de fichiers (au revoir buckets S3)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/jobs/">Job queues / message broker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/cache/">Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/search-engine/">Moteur de recherche</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/maintenance/">Faire la maintenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/database-for-everything/portability-checks/">Suis-je toujours un produit portable avec mon stateful ?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/simple-and-sovereign-cloud-provider/">Un hébergeur simple et souverain</a><button aria-label="Plier/Déplier la catégorie &#x27;Un hébergeur simple et souverain&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user-authentication/">Authentifier les utilisateurs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/continuous-integration-and-continuous-deployment/">L&#x27;intégration et le déploiement continu (CI/CD)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environments/">Avoir différents environnements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tests-and-the-mock-limit/">Les tests et la limite du mock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/error-handling/">La gestion d&#x27;erreurs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/backups/">Backups</a><button aria-label="Plier/Déplier la catégorie &#x27;Backups&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-patterns/">Design patterns</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/security/">Sécurité primaire</a><button aria-label="Plier/Déplier la catégorie &#x27;Sécurité primaire&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/growth/">Faire connaître son produit</a><button aria-label="Plier/Déplier la catégorie &#x27;Faire connaître son produit&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/monitoring/">Faire la vigie en étant outillé</a><button aria-label="Plier/Déplier la catégorie &#x27;Faire la vigie en étant outillé&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/accessibility-is-mandatory/">L&#x27;accessibilité est obligatoire</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/inclusive-writing/">L&#x27;écriture inclusive</a><button aria-label="Plier/Déplier la catégorie &#x27;L&#x27;écriture inclusive&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/legal/">Le légal</a><button aria-label="Plier/Déplier la catégorie &#x27;Le légal&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/go-further/">Aller plus loin</a><button aria-label="Plier/Déplier la catégorie &#x27;Aller plus loin&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/technical-recommandations/"><span itemprop="name">Recommandations techniques argumentées</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/database-for-everything/"><span itemprop="name">Une base de données qui fait tout (vraiment)</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Stockage de fichiers (au revoir buckets S3)</span><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Stockage de fichiers (au revoir buckets S3)</h1><p>Bien que le bucket S3 soit devenu une référence voire même le choix par défaut quand on commence un projet, <strong>on aimerait vous mettre en garde</strong> en redétaillant l&#x27;intégration d&#x27;un bucket S3 au sein d&#x27;un applicatif.</p><p>Si vous utilisez du S3 vous allez normalement stocker vos fichiers dans un espace distinct de votre base de données. Chaque fichier aura une URL unique, et dans votre base de données vous garderez en référence cette URL. Vous vous retrouvez dans la situation où les deux peuvent ne plus être synchronisés, avoir l&#x27;URL dans votre base de données ne veut pas dire que le fichier existe sur votre bucket S3.</p><p>Sachez qu&#x27;une PostgreSQL est capable de gérer au sein d&#x27;une colonne des fichiers faisant maximum 1 Go chacun, il faut pour cela utiliser le type <code>BYTEA</code> (qui utilise le <a href="https://www.postgresql.org/docs/current/storage-toast.html" target="_blank" rel="noopener noreferrer">TOAST</a>).</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Information</div><div class="admonitionContent_S0QG"><p>Il existe aussi la possibilité de stocker des &quot;<a href="https://www.postgresql.org/docs/current/largeobjects.html" target="_blank" rel="noopener noreferrer">large objects</a>&quot; qui peuvent faire jusqu&#x27;à 4 To chacun, il faut une étape supplémentaire pour les ajouter avant de les référencer dans une table traditionnelle. Et cela pose des questions de volumétrie qui seront abordés plus loin.</p></div></div><p><strong>Vous devez spécifier et quantifier ce que vous allez héberger pour dire oui ou non aux buckets S3.</strong></p><p>Un élément important qui est mentionné dans <a href="/docs/legal/data-lifecycle/">le chapitre légal</a> et qui doit être pris en compte dans votre calcul : <strong>la CNIL recommande de ne pas conserver les données utilisateurs plus de 2 ans</strong>.</p><p>Cas concrets :</p><ol><li>Si je sais que mon produit ne va héberger que des photos de profil des agents publics et les logos de toutes les collectivités de France. Je sais d&#x27;avance que la totalité des fichiers ne dépassera jamais une certaine limite. <strong>Ma PostgreSQL suffit</strong> ;</li><li>Si mon outil reçoit des demandes de médiations et que chaque citoyen et agent public peut ajouter à chaque demande des pièces justificatives (limitées à 5 Mo chacune), a priori il n&#x27;y a pas de limite (cela peut être exponentiel). Sauf que l&#x27;on sait historiquement qu&#x27;il y a en moyenne 5 fichiers par dossier, et 10 000 dossiers créés par an. Comme l&#x27;outil supprime les dossiers après 2 ans pour respecter la recommandation CNIL, le stockage reste acceptable et une <strong>PostgreSQL devrait suffire</strong> ;</li><li>Si mon outil archive les médias réalisés durant des événements publiques, j&#x27;accepte ainsi des photos en haute qualité (10 Mo ou plus) et des vidéos qui peuvent faire plusieurs heures (plusieurs Go). De plus, du fait de la volonté d&#x27;archiver la recommandation CNIL n&#x27;est pas appliquée. Je me retrouve avec un enjeu stratégique sur le stockage, <strong>ma PostgreSQL n&#x27;est pas adaptée, je choisis du S3</strong>.</li></ol><p>Points importants (hors problématiques de stockage) :</p><ul><li>Nous devons rester sur des tailles de fichiers acceptables quand on passe via PostgreSQL car c&#x27;est notre propre API qui sera sollicitée pour servir le flux ;</li><li>En utilisant une base PostgreSQL pour le stockage <strong>il ne faut jamais essayer de produire vous-même la logique d&#x27;upload d&#x27;un fichier</strong>. Cela implique beaucoup de technique : headers HTTP, le &quot;resumable upload&quot; (fait de reprendre une upload si la connexion internet est perdue durant quelques secondes)… <strong>Nous préconisons plutôt d&#x27;utiliser <a href="https://github.com/tus" target="_blank" rel="noopener noreferrer"><code>tus</code></a></strong> (<a href="https://github.com/tus/tus-js-client" target="_blank" rel="noopener noreferrer">client</a> et <a href="https://github.com/tus/tus-node-server" target="_blank" rel="noopener noreferrer">serveur</a>) sachant qu&#x27;ils proposent <a href="https://github.com/tus/tus-node-server/tree/main/packages/server#example-integrate-tus-into-nextjs" target="_blank" rel="noopener noreferrer">une intégration dans l&#x27;API Next.js</a> ;</li><li><strong>Si vous utilisez des buckets S3, ne faites pas transiter les fichiers par votre API.</strong> Vous avez sûrement choisi S3 car il est question de volumétrie importante. Le fait d&#x27;utiliser votre API en intermédiaire met un point de congestion et fait reposer sur vous le fait de bien dimensionner votre API alors qu&#x27;une upload/lecture peut être anecdotique (<strong>sachant que ça peut en plus perturber vos opérations sensibles sur l&#x27;API</strong>). Nous recommandons dans ce cas de choisir un fournisseur S3 qui permet de &quot;signer des URLs&quot; que ce soit en lecture ou en upload. Avec cette architecture aucun fichier ne transite via votre API :<ol><li>Votre frontend demande à l&#x27;API &quot;je veux uploader un fichier&quot; ;</li><li>L&#x27;API renvoie une nouvelle URL signée du provider S3 ;</li><li>Le frontend peut uploader son fichier directement sur l&#x27;URL signée (en utilisant une librairie cliente compatible comme <a href="https://github.com/tus/tus-js-client" target="_blank" rel="noopener noreferrer"><code>tus</code></a>) et obtient l&#x27;URL finale du fichier uploadé ;</li><li>Le frontend peut transmettre l&#x27;URL du fichier uploadé à l&#x27;API ;</li><li>L&#x27;API est en mesure de valider le fichier de façon synchrone (ou non), et d&#x27;enregister l&#x27;URL en base de données.</li></ol></li></ul><p>Notez que <strong>les technologies comme <code>tus</code> ou S3 ne gèrent pas les règles de sécurité propres à votre métier</strong> (qui peut uploader ? qui peut lire ce fichier ?). C&#x27;est à vous de gérer cette partie. Nous abordons cela plus en détail dans <a href="/docs/security/secure-hosted-files-urls/">le chapitre sur la sécurité</a>.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Écrire et lire des fichiers dans votre base de données va forcément utiliser un peu plus de ressources (notamment la bande passante). N&#x27;hésitez pas à &quot;augmenter&quot; les performances de votre base si besoin, et à dimensionner le tuyau d&#x27;entrée pour faire passer les fichiers :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Next.js</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Nginx</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6">Il faudrait augmenter la configuration dans le fichier du endpoint d&#x27;upload en exportant par exemple :<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-endpoint.tsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  api</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bodyParser</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sizeLimit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10mb&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>  </div><div role="tabpanel" class="tabItem_Ymn6" hidden="">Il faudrait augmenter la configuration :<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/nginx/http.d/default.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_max_body_size 10M;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>  </div></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/betagouv/sillon/tree/main/docs/database-for-everything/file-storage.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Éditer cette page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/database-for-everything/dream-of-unique-storage/"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Un seul espace de stockage, ça serait le rêve ?</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/database-for-everything/jobs/"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Job queues / message broker</div></a></nav></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/legal-notice/">Mentions légales</a><span class="footer__link-separator">·</span><a href="https://github.com/betagouv/sillon" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://beta.gouv.fr" target="_blank" rel="noopener noreferrer" class="footer__link-item">beta.gouv<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/assets/logo/betagouv.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/assets/logo/betagouv.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Sauf mention contraire, tous les contenus de ce site sont sous <a href="https://raw.githubusercontent.com/betagouv/sillon/main/LICENSE">licence MIT</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.27e77d59.js"></script>
<script src="/assets/js/main.133bd396.js"></script>
</body>
</html>