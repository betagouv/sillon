# Moteur de recherche

Certains produits auront peut-Ãªtre besoin d'un outil lourd comme [ElasticSearch](https://www.elastic.co/) pour stocker et optimiser les recherches Ã  effectuer, mais encore une fois, dans la grande majoritÃ© des cas [votre PostgreSQL suffira](https://www.postgresql.org/docs/current/textsearch.html).

Nous ne vous proposons quand mÃªme pas de retourner Ã  l'opÃ©rateur SQL `LIKE %ma recherche%` â€‹â€‹ğŸ‘µ, mais plutÃ´t d'utiliser [les types de donnÃ©es `tsquery` et `tsvector`](https://www.postgresql.org/docs/current/datatype-textsearch.html). Si comme conseillÃ© vous utilisez l'ORM Prisma, l'utilisation est [assez facile et quasi transparente sur des colonnes distinctes](https://www.prisma.io/docs/concepts/components/prisma-client/full-text-search). Par contre cela ne marchera pas si vous cherchez â€œJohn Doeâ€ et que â€œJohnâ€ est dans la colonne `firstname` et â€œDoeâ€ dans la colonne `lastname`.

Pour faire ce type de recherche sur plusieurs colonnes (exemple : le prÃ©nom, le nom, l'adresse, la biographie), la stratÃ©gie est de [concatÃ©ner](https://fr.wiktionary.org/wiki/concat%C3%A9ner) chaque colonne voulue [dans une colonne gÃ©nÃ©rÃ©e](https://www.postgresql.org/docs/current/ddl-generated-columns.html) et indexÃ©e, reprÃ©sentant un _tsvector_. Cette colonne est donc optimisÃ©e pour de la recherche.

[Prisma ne gÃ¨re pas encore nativement les colonnes gÃ©nÃ©rÃ©es](https://github.com/prisma/prisma/issues/6336), mais rien ne vous empÃªche de la crÃ©er Ã  la main. DiffÃ©rents articles existent sur internet mais pour vous donner une idÃ©e cela donnerait quelque chose comme :

```sql showLineNumbers
ALTER TABLE MyTable
ADD search TSVECTOR
GENERATED ALWAYS AS (
  to_tsvector('english',
    firstname || ' ' || lastname || ' ' || biography || ' ' || full_address
  )
) STORED;
```

PlutÃ´t que de juste concatÃ©ner bÃªtement les colonnes, on transforme le tout en `tsvector` afin qu'il soit dÃ©jÃ  optimisÃ© pour la recherche.

_Ã€ noter qu'un `tsvector` est optimisÃ© pour une langue en particulier afin de trier les mots. Par dÃ©faut, c'est la configuration `default_text_search_config` qui est utilisÃ©e. Sachez que mÃªme si votre contenu est en franÃ§ais, faites des tests avec `english` avant d'utiliser la valeur `french`. Cette derniÃ¨re diffÃ©rencie les mots avec ou sans accent, ce qui peut Ãªtre problÃ©matiqueâ€¦ N'hÃ©sitez pas Ã  jeter un Å“il Ã  [toutes les options de langues possibles](https://www.postgresql.org/docs/current/textsearch-psql.html)._
