<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-security/secure-hosted-files-urls" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Sécuriser les URLs des fichiers hébergés | Sillon</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://sillon.incubateur.net/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://sillon.incubateur.net/img/social-card.png"><meta data-rh="true" property="og:url" content="https://sillon.incubateur.net/docs/security/secure-hosted-files-urls/"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Sécuriser les URLs des fichiers hébergés | Sillon"><meta data-rh="true" name="description" content="Que nous utilisions un hébergement de fichiers en base ou via des buckets S3, il faut garantir que les URLs de nos fichiers sensibles soient éphémères. Même si vous avez un identifiant de fichier aléatoire (UUID) et que vous estimez qu&#x27;on ne peut pas deviner l&#x27;URL :"><meta data-rh="true" property="og:description" content="Que nous utilisions un hébergement de fichiers en base ou via des buckets S3, il faut garantir que les URLs de nos fichiers sensibles soient éphémères. Même si vous avez un identifiant de fichier aléatoire (UUID) et que vous estimez qu&#x27;on ne peut pas deviner l&#x27;URL :"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://sillon.incubateur.net/docs/security/secure-hosted-files-urls/"><link data-rh="true" rel="alternate" href="https://sillon.incubateur.net/docs/security/secure-hosted-files-urls/" hreflang="fr"><link data-rh="true" rel="alternate" href="https://sillon.incubateur.net/docs/security/secure-hosted-files-urls/" hreflang="x-default"><link rel="preconnect" href="https://stats.beta.gouv.fr/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://stats.beta.gouv.fr/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","52"]);var t=document,a=t.createElement("script"),p=t.getElementsByTagName("script")[0];a.type="text/javascript",a.async=!0,a.src=e+"matomo.js",p.parentNode.insertBefore(a,p)}()</script><link rel="stylesheet" href="/assets/css/styles.c035a662.css">
<link rel="preload" href="/assets/js/runtime~main.27e77d59.js" as="script">
<link rel="preload" href="/assets/js/main.133bd396.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/assets/logo/betagouv.png" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/assets/logo/betagouv.png" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Sillon</b></a></div><div class="navbar__items navbar__items--right"><a href="/assets/sillon.pdf" class="button button--secondary margin-horiz--sm hide-on-small"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="file-lines" class="svg-inline--fa fa-file-lines margin-right--sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M64 464c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16H224v80c0 17.7 14.3 32 32 32h80V448c0 8.8-7.2 16-16 16H64zM64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V154.5c0-17-6.7-33.3-18.7-45.3L274.7 18.7C262.7 6.7 246.5 0 229.5 0H64zm56 256c-13.3 0-24 10.7-24 24s10.7 24 24 24H264c13.3 0 24-10.7 24-24s-10.7-24-24-24H120zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24H264c13.3 0 24-10.7 24-24s-10.7-24-24-24H120z"></path></svg>PDF</a><button class="button button--secondary margin-horiz--sm hide-on-small"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="comment" class="svg-inline--fa fa-comment margin-right--sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M123.6 391.3c12.9-9.4 29.6-11.8 44.6-6.4c26.5 9.6 56.2 15.1 87.8 15.1c124.7 0 208-80.5 208-160s-83.3-160-208-160S48 160.5 48 240c0 32 12.4 62.8 35.7 89.2c8.6 9.7 12.8 22.5 11.8 35.5c-1.4 18.1-5.7 34.7-11.3 49.4c17-7.9 31.1-16.7 39.4-22.7zM21.2 431.9c1.8-2.7 3.5-5.4 5.1-8.1c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208s-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6c-15.1 6.6-32.3 12.6-50.1 16.1c-.8 .2-1.6 .3-2.4 .5c-4.4 .8-8.7 1.5-13.2 1.9c-.2 0-.5 .1-.7 .1c-5.1 .5-10.2 .8-15.3 .8c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c4.1-4.2 7.8-8.7 11.3-13.5c1.7-2.3 3.3-4.6 4.8-6.9c.1-.2 .2-.3 .3-.5z"></path></svg>Support</button><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Recherche" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Présentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/preamble/">Préambule</a><button aria-label="Plier/Déplier la catégorie &#x27;Préambule&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/project-start/">Amorce du projet</a><button aria-label="Plier/Déplier la catégorie &#x27;Amorce du projet&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/prototyping/">Prototypage</a><button aria-label="Plier/Déplier la catégorie &#x27;Prototypage&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/development/">Développement du produit</a><button aria-label="Plier/Déplier la catégorie &#x27;Développement du produit&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/document/">Documenter votre projet</a><button aria-label="Plier/Déplier la catégorie &#x27;Documenter votre projet&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/community-and-open-source/">Communauté &amp; open source</a><button aria-label="Plier/Déplier la catégorie &#x27;Communauté &amp; open source&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/sovereignty/">Souveraineté du projet</a><button aria-label="Plier/Déplier la catégorie &#x27;Souveraineté du projet&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/state-identity/">Utiliser la charte graphique de l&#x27;État</a><button aria-label="Plier/Déplier la catégorie &#x27;Utiliser la charte graphique de l&#x27;État&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/technical-recommandations/">Recommandations techniques argumentées</a><button aria-label="Plier/Déplier la catégorie &#x27;Recommandations techniques argumentées&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/security/">Sécurité primaire</a><button aria-label="Plier/Déplier la catégorie &#x27;Sécurité primaire&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/raise-awareness/">Sensibiliser</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/enable-ssl/">Chiffrement SSL par défaut</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/password-strength/">Robustesse des mots de passe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/password-manager/">Gestionnaire de mots de passe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/two-factor-authentication/">2FA / Security keys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/manage-access-and-monitor/">Accès restreints et alertes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/officer/">RSSI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/cve-monitoring/">Surveiller les CVE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/data-leak-actions/">En cas de fuite de données</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/security-audits/">Audits de sécurité</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/http-headers/">Configurer les headers HTTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/security/secure-hosted-files-urls/">Sécuriser les URLs des fichiers hébergés</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security/avoid-infected-files/">Se prémunir des fichiers infectés</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/growth/">Faire connaître son produit</a><button aria-label="Plier/Déplier la catégorie &#x27;Faire connaître son produit&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/monitoring/">Faire la vigie en étant outillé</a><button aria-label="Plier/Déplier la catégorie &#x27;Faire la vigie en étant outillé&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/accessibility-is-mandatory/">L&#x27;accessibilité est obligatoire</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/inclusive-writing/">L&#x27;écriture inclusive</a><button aria-label="Plier/Déplier la catégorie &#x27;L&#x27;écriture inclusive&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/legal/">Le légal</a><button aria-label="Plier/Déplier la catégorie &#x27;Le légal&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/go-further/">Aller plus loin</a><button aria-label="Plier/Déplier la catégorie &#x27;Aller plus loin&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/security/"><span itemprop="name">Sécurité primaire</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Sécuriser les URLs des fichiers hébergés</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Sécuriser les URLs des fichiers hébergés</h1><p>Que nous utilisions <a href="/docs/database-for-everything/file-storage/">un hébergement de fichiers en base ou via des buckets S3</a>, il faut garantir que les URLs de nos fichiers sensibles soient éphémères. Même si vous avez un identifiant de fichier aléatoire (UUID) et que vous estimez qu&#x27;on ne peut pas deviner l&#x27;URL :</p><ul><li>L&#x27;URL peut être gardée dans l&#x27;historique de navigation ;</li><li>L&#x27;utilisateur légitime peut l&#x27;avoir stockée dans un autre endroit visible par d&#x27;autres ;</li><li>L&#x27;utilisateur peut ne plus être légitime pour voir ce fichier.</li></ul><p>En ajoutant une durée de validité à l&#x27;URL du fichier vous garantissez que le fichier ne sera vu que dans le contexte où l&#x27;utilisateur aura communiqué avec l&#x27;API. <em>Bien entendu, pour des fichiers publics qui peuvent être indexés (logos…), il n&#x27;y a aucune raison d&#x27;y ajouter une sécurité.</em></p><p>L&#x27;idée est de donner une validité à notre URL en y ajoutant en paramètre une signature (générée par chiffrement). Imaginons que nous sommes dans une SPA (les appels API se font en asynchrone du chargement de page) :</p><ol><li>L&#x27;utilisateur va sur <code>monsite.com/compte</code> ;</li><li>Le frontend demande à l&#x27;API de récupérer l&#x27;objet utilisateur ;</li><li>L&#x27;API :<ol><li>Récupère l&#x27;utilisateur en base de données et voit que la propriété <code>private_photo</code> est une pièce jointe qui a l&#x27;identifiant 123 ;</li><li>Passe l&#x27;identifiant dans un petit helper qui va d&#x27;abord générer l&#x27;url finale <code>monsite.com/fichier?id=123</code> ;</li><li>Puis générer un JWT avec comme payload <code>urn:claim:file_id = 123</code> et une validité de 10 minutes pour ensuite l&#x27;ajouter en paramètre pour donner <code>monsite.com/fichier?id=123?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cm46Y2xhaW06ZmlsZV9pZCI6IjEyMyIsImlhdCI6MTUxNjIzOTAyMn0.xpP88WITmYZ-F0l1iL_VbAcc-PBU53xeE4Dnm-M9Pj4</code> ;</li><li>Renvoie l&#x27;objet utilisateur avec pour <code>private_photo</code> l&#x27;URL finale.</li></ol></li></ol><p>C&#x27;est très schématisé mais c&#x27;est l&#x27;idée. Ainsi le endpoint <code>/fichier</code> a juste à vérifier la validité du JWT avec n&#x27;importe quelle librairie JWT classique.</p><ul><li>Si vous utilisez les buckets S3 : certains providers de buckets S3 ont cette fonctionnalité de signature d&#x27;URL, il faut donc que votre backend se charge de signer l&#x27;URL avec la librairie cliente du provider ;</li><li>Sinon si vous êtes en base de données il faut créer vous-même ce petit helper.</li></ul><p>Le bénéfice d&#x27;avoir la génération de l&#x27;URL signée quand on récupère la donnée métier est que vous passez forcément par les étapes de vérification des droits d&#x27;accès. Vous évitez ainsi de centraliser les droits d&#x27;accès au niveau de la table de fichiers (qui ont des risques d&#x27;être désynchronisés avec les vrais entités métiers).</p><p>Quelques points importants (que ce soit en base ou via S3 directement) :</p><ul><li>La validité du JWT n&#x27;a pas besoin d&#x27;être très longue puisque aussitôt le frontend récupère les données, aussitôt il va charger le fichier (le fichier peut être gardé en cache) ;</li><li>En l&#x27;état actuel des choses, la mise en cache ne va pas marcher car le JWT est différent à chaque affichage de page. La technique est de rendre fixe l&#x27;URL sur un intervalle donné (ce n&#x27;est pas parfait, mais ça fait le travail) :<ul><li>Au moment de générer le JWT on spécifie la date d&#x27;expiration en utilisant un modulo (de 10 minutes par exemple) ;</li><li>Les expirations se font donc à des &quot;heures fixes&quot; (1h10, 1h20, 1h30…) ;</li></ul></li><li>Assurez-vous quand même sur votre endpoint de renvoyer le header HTTP <code>Cache-Control</code> afin d&#x27;adapter le contexte et de ne pas garder localement des images dont la validité a expiré :<ul><li>Pour un fichier public avec la valeur : <code>public, immutable, no-transform, max-age=0</code></li><li>Pour un fichier privé avec la valeur : <code>private, max-age=${minutesToSeconds(15)}</code>.</li></ul></li></ul><p><em>Désolés si l&#x27;ensemble paraît être un peu de travail, mais c&#x27;est le nécessaire pour sécuriser proprement les fichiers (l&#x27;utilisation d&#x27;un S3 prend en charge quelques étapes mais laisse reposer sur vous l&#x27;architecture de sécurisation ainsi que sa mise en place).</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/betagouv/sillon/tree/main/docs/security/secure-hosted-files-urls.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Éditer cette page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/security/http-headers/"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Configurer les headers HTTP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/security/avoid-infected-files/"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Se prémunir des fichiers infectés</div></a></nav></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/legal-notice/">Mentions légales</a><span class="footer__link-separator">·</span><a href="https://github.com/betagouv/sillon" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://beta.gouv.fr" target="_blank" rel="noopener noreferrer" class="footer__link-item">beta.gouv<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/assets/logo/betagouv.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/assets/logo/betagouv.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Sauf mention contraire, tous les contenus de ce site sont sous <a href="https://raw.githubusercontent.com/betagouv/sillon/main/LICENSE">licence MIT</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.27e77d59.js"></script>
<script src="/assets/js/main.133bd396.js"></script>
</body>
</html>